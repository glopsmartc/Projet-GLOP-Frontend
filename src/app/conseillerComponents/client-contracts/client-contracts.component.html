<div class="container my-4">
  <h1 class="text-center">Liste des Contrats Clients</h1>
  <br>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Chargement des contrats en cours...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Search Input -->
  <input type="text" class="form-control mb-3" placeholder="Rechercher un client..." [(ngModel)]="searchText" />

  <!-- No Contracts Message -->
  <div *ngIf="!isLoading && groupedClients.length === 0" class="alert alert-info" role="alert">
    Aucun contrat trouvé.
  </div>

  <!-- Clients List -->
  <div *ngIf="!isLoading && groupedClients.length > 0">
    <div *ngFor="let client of filteredClients()" class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>{{ client.nom }} {{ client.prenom }}</strong>
        <button class="btn btn-link" (click)="client.showContracts = !client.showContracts">
          {{ client.showContracts ? 'Masquer' : 'Voir les contrats' }}
        </button>
      </div>
      <div *ngIf="client.showContracts" class="card-body">
        <p><strong>Téléphone :</strong> {{ client.telephone }}</p>
        <p><strong>Email :</strong> {{ client.email }}</p>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Statut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contract of client.contrats">
                <td>{{ contract.statut === 'actif' ? 'Actif' : contract.statut }}</td>
              <td>
                <button class="btn btn-primary" style="padding: 3px 15px;" (click)="onDownloadContract(contract.id)">
                  Télécharger le PDF
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
